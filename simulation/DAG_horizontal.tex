\documentclass[tikz,border=5pt]{standalone}
\usepackage{tikz}
\usetikzlibrary{bayesnet}
\usepackage{xcolor}

% background colors
\definecolor{family1bg}{RGB}{255,245,245}  
\definecolor{family2bg}{RGB}{245,245,255}  

\begin{document}

\begin{tikzpicture}

  % Family 1 background
  \begin{scope}[on background layer]
    \fill[family1bg, rounded corners] (2, 3.0) rectangle (7.5, 4.5);
  \end{scope}
  \draw[dashed, rounded corners, thick, color=gray!70] (2, 3.0) rectangle (7.5, 4.5);
  \node at (4.8, 4.7) {\textbf{Family 1}};

  % Family 2 background
  \begin{scope}[on background layer]
    \fill[family2bg, rounded corners] (2, -2.0) rectangle (7.5, -0.5);
  \end{scope}
  \draw[dashed, rounded corners, thick, color=gray!70] (2, -2.0) rectangle (7.5, -0.5);
  \node at (4.8, -2.2) {\textbf{Family 2}};

  % Time/states
  \node[latent] (st_1) at (0, 1.0) {$S_{t-1}$};
  \node[latent] (A) at (1.5, 1.0) {\textbf{A}};
  \node[const] (eta) at (1.5, 1.8) {$\eta$};
  \node[latent] (st) at (3.2, 1.0) {$S_t$};
  \draw[->] (eta) -- (A) node[midway, right=-30pt] {\scriptsize (prior)};
  \draw[-] (st_1) -- (A);
  \draw[->] (A) -- (st) node[midway, above=3pt] {\scriptsize Categorical};

  % Family 1
  \node[obs, fill=gray!20] (xpt) at (2.5, 3.8) {$x_{pt}$};
  \node[latent] (pi) at (4.8, 3.8) {$\pi_{pt}$};
  \node[latent] (b1) at (7.1, 3.8) {$\beta_1$};
  \node[const] (lambda_b1) at (7.1, 4.6) {$\lambda_{\beta_1}$};
  \draw[->] (lambda_b1) -- (b1) node[midway, right=2pt] {\scriptsize (prior)};

  % Family 2
  \node[obs, fill=gray!20] (xqt) at (2.5, -1.2) {$x_{qt}$};
  \node[latent] (psi) at (4.8, -1.2) {$\psi_{qt}$};
  \node[latent] (b2) at (7.1, -1.2) {$\beta_2$};
  \node[const] (lambda_b2) at (7.1, -2) {$\lambda_{\beta_2}$};
  \draw[->] (lambda_b2) -- (b2) node[midway, right=2pt] {\scriptsize (prior)};

  % From state
  \draw[->] (st) -- (pi);
  \draw[->] (st) -- (psi);

  % Dirichlet generation
  \draw[->] (xpt) -- (pi) node[midway, above=4pt] {\scriptsize Dirichlet};
  \draw[->] (b1) -- (pi);
  \draw[->] (xqt) -- (psi) node[midway, below=4pt] {\scriptsize Dirichlet};
  \draw[->] (b2) -- (psi);

  % Dyads box
\draw[rounded corners, thick, color=gray!70] (7.8, -0.9) rectangle (13.8, 3.0);
  \node at (12.8, 3.2) {\textbf{Dyads $(p,q)$}};

  \node[latent] (z) at (8.6, 2.2) {$z_{pqt}$};
  \node[latent] (u) at (8.6, 0.5) {$u_{pqt}$};
  \node[latent] (bzu) at (10.5, 1.4) {$B_{z,u}$};
  \node[obs, fill=gray!20] (d) at (11, 0.5) {$d_{pqt}$};
  \node[latent] (gamma) at (12.8, 0.5) {$\gamma$};
  \node[const] (lambda_gamma) at (12.8, -0.6) {$\lambda_{\gamma}$};
  \node[obs, draw=black, thick, fill=gray!20] (y) at (12, 1.4) {$Y_{pqt}$};
  \draw[->] (lambda_gamma) -- (gamma) node[midway, right=2pt] {\scriptsize (prior)};

  % Arrows
  \draw[->] (pi) -- (z) node[midway, below=1.5pt] {\scriptsize Categorical};
  \draw[->] (psi) -- (u) node[midway, above=1pt] {\scriptsize Categorical};

  \draw[->] (z) -- (bzu);
  \draw[->] (u) -- (bzu);
  \draw[->] (bzu) -- (y) node[midway, above=6pt] {\scriptsize Bernoulli};
  \draw[->] (d) -- (y);
  \draw[->] (gamma) -- (y);

\end{tikzpicture}

\end{document}
